<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Engineering Thesis Project</title>
    <!--Import Google Icon Font-->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Import materialize.css-->
      <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>

      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<script src="js/plotly-latest.min.js"></script>

</head>
<body>
    <div class="center">
        <h2></h2>
    </div>
    <div class="container">
        <a class="waves-effect waves-light btn start-button">start processing samples</a>
        <h4>Processed samples:</h4>
        <h4 id="samples">0</h4>
<!--        <h4>Current model name:</h4>-->
<!--        <h4 id="model-name"></h4>-->
<!--        <h4>Current model version:</h4>-->
<!--        <h4 id="model-version"></h4>-->
        <h4>Roc Auc score:</h4>
        <h4 id="roc-auc-score">0.000</h4>
    </div>
    <div class="container center">
        <h5>Correct predictions [%]:</h5>
        <div id="chart"></div>
    </div>
    <script type="text/javascript">

        var ws_client = new WebSocket("ws://0.0.0.0:8765");
        var ws_eval = new WebSocket("ws://0.0.0.0:8766");

        var start_button = document.querySelector('.start-button');

        start_button.onclick = async function (event) {
            console.log('start');
            ws_client.send('start');
            ws_eval.send('start');

<!--            var samples = document.getElementById("samples");-->
<!--            var model_name = document.getElementById("model-name");-->
<!--            var model_version = document.getElementById("model-version");-->
            ws_client.onmessage = async function (event) {
                var message = JSON.parse(event.data);
<!--                samples_counter = message["samples"];-->
<!--                model_name.innerHTML = message["model_name"];-->
<!--                model_version.innerHTML = message["model_version"];-->
            };
        }

        Plotly.plot('chart',[{
            y:[0],
            type:'line'
        }]);
        var cnt = 0;
        ws_eval.onmessage = async function (event) {
            var message = JSON.parse(event.data);
            console.log(message);
            var correct_prediction_ratio = message["correct_predictions"] / message["processed_samples"];
            Plotly.extendTraces('chart',{ y:[[correct_prediction_ratio]]}, [0]);
            cnt++;

            var samples = document.getElementById("samples");
            samples.innerHTML = message["processed_samples"];
            var roc_auc_score = document.getElementById("roc-auc-score");
            roc_auc_score.innerHTML = message["roc_auc_score"].toPrecision([3]);

            if(cnt > 500) {
                Plotly.relayout('chart',{
                    xaxis: {
                       range: [cnt-500,cnt]
                    }
                });
            }
        }

    </script>
    <script type="text/javascript" src="js/materialize.min.js"></script>
</body>
</html>