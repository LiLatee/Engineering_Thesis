<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Engineering Thesis Project</title>
    <!--Import Google Icon Font-->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Import materialize.css-->
      <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>

      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<script src="js/plotly-latest.min.js"></script>

</head>
<body>
    <div class="container" style="padding-top: 32px">
        <a class="waves-effect waves-light btn start-button">start processing samples</a>
        <h4>Processed samples:</h4>
        <h4 id="samples">0</h4>
        <h4>Roc Auc score:</h4>
        <h4 id="roc-auc-score">0.000</h4>
    </div>
    <div class="container center">
        <h5>Correct predictions [%]:</h5>
        <div id="models"></div>
    </div>
    <script type="text/javascript">
        document.getElementById('models').innerHTML += "<div id=\""+ "chart" +"\"></div>";
        Plotly.plot("chart", [
                {
                    y: [0],
                    x: 0
                },
                {
                    y: [0],
                    x: 0
                },
                {
                    y: [0],
                    x: 0
                },
                {
                    y: [0],
                    x: 0
                },
                {
                    y: [0],
                    x: 0
                },
                {
                    y: [0],
                    x: 0
                },
                {
                    y: [0],
                    x: 0
                },
                {
                    y: [0],
                    x: 0
                }]);


        var ws_client = new WebSocket("ws://0.0.0.0:8765");
        var ws_eval = new WebSocket("ws://0.0.0.0:8766");

        var start_button = document.querySelector('.start-button');

        start_button.onclick = async function (event) {
            console.log('start');
            ws_client.send('start');
            ws_eval.send('start');
        };


        var cnt = 0;
        first_model_ctn = 3;
        ws_eval.onmessage = async function (event) {

            var message = JSON.parse(event.data);
            console.log("message");
            console.log(message);
            let list_of_correct_prediction_ratio = [[0],[0],[0],[0],[0],[0],[0],[0]]
            for(var key in message) {
                if(message.hasOwnProperty(key)) {
                    model = message[key];
                    console.log("rekord");
                    console.log(model);
                    list_of_correct_prediction_ratio[model.id-1] = [model["correct_predictions"] / model["processed_samples"]]
                    cnt++;

                    var samples = document.getElementById("samples");
                    samples.innerHTML = model["processed_samples"];
                    var roc_auc_score = document.getElementById("roc-auc-score");
                    roc_auc_score.innerHTML = model["roc_auc_score"].toPrecision([3]);
                }
            }
            console.log(list_of_correct_prediction_ratio)
            Plotly.extendTraces(
              "chart",
              {
                  y: list_of_correct_prediction_ratio
              },
              [0,1,2,3,4,5,6,7]);


            if(cnt > 500) {
                Plotly.relayout("chart",{
                    xaxis: {
                        range: [cnt-500,cnt]
                    }
                });
            }
        }

    </script>
    <script type="text/javascript" src="js/materialize.min.js"></script>
</body>
</html>